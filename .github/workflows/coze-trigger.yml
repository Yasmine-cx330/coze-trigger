name: Coze Workflow Scheduled Trigger
on:
  schedule:
    # 17:55 触发（UTC 09:55）
    - cron: '55 9 * * *'
  workflow_dispatch:  # 新增：允许手动触发

jobs:
  trigger-coze-workflow:
    runs-on: ubuntu-latest
    steps:
      - name: 调用Coze API触发工作流
        run: |
          REQUEST_BODY=$(cat << EOF
          {
            "workflow_id": "7587672674312601635",
            "parameters": {
              "key": "SCT306988TmH94YUCy632TxeD8p6LxoEEZ",
              "rss_list": "https://testyaxin.zeabur.app/feeds/MP_WXS_3920256514.atom
          https://testyaxin.zeabur.app/feeds/MP_WXS_3919437249.atom
          https://testyaxin.zeabur.app/feeds/MP_WXS_3005106710.atom
          https://testyaxin.zeabur.app/feeds/MP_WXS_3080421900.atom"
            }
          }
          EOF
          )
          curl -X POST \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer pat_cNxCHWFzS2Ui9LvTyKJaRcxQ5sj7hxF7YTNGjxnIYjw8E5dFCyznIhV6OtLTfoND" \
          -d "$REQUEST_BODY" \
          "https://api.coze.cn/v1/workflow/run" \
          --retry 3 \
          --retry-delay 5
